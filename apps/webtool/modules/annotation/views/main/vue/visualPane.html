<script>
    Vue.component('visual-pane', {
            template: '#visual-pane',
            props: [],
            data() {
                return {
                    title: 'Visual Annotation',
                    videoTitle: this.$store.state.model.documentMM.videoTitle,
                    segments: this.$store.state.model.segments,
                    currentSegment: 0,
                    framesRange: {
                        first: 0,
                        last: 0
                    },
                    player: null,
                    playerData: null,
                    ignore_timeupdate: false,
                    options: {},
                    objects: [],
                    newObjectFrame: null,
                }
            },
            computed: {},
            created() {
            },
            mounted() {
                console.log(this.segments);
                let that = this;
                $('#segments').combobox({
                    value: this.currentSegment,
                    data: this.segments,
                    onChange: function (value) {
                        that.changeSegment(value);
                    }
                })
            },
            methods: {
                changeSegment(value) {
                    this.currentSegment = value;
                    console.log(this.currentSegment);
                },
                framesLoaded(firstFrame, lastFrame) {
                    console.log('Frames Loaded! ' + firstFrame + ' to ' + lastFrame);
                    this.framesRange = {
                        first: firstFrame,
                        last: lastFrame
                    }
                },
                changeValue(value) {

                },
                onNewObject(currentFrame) {
                    console.log('newObject');
                    this.newObjectFrame = currentFrame;
                },
                newObject(objectsTracker) {
                    console.log('new Object');
                    //this.annotatedObjectsSet.add(object)
                    console.log(objectsTracker);
                    this.objects = [];
                    for (object of objectsTracker.annotatedObjects) {
                        this.objects.push(object)
                    }

                },
            },
        }
    );
</script>

<script type="text/x-template" id="visual-pane">
    <Panel id="visualAnnotation" :border="false"
           style="width:100%;height: 1500px;margin:10px;background:#fafafa;text-align:center">
        <div id="container" style="display:inline-block; ">
            <div id="videoSegment" style="margin:8px">
                <h3>{{videoTitle}}</h3>
                <input id="segments"></input>
            </div>
            <div id="videoPane">
                <video-pane :segment="currentSegment" :newObjectFrame="newObjectFrame"
                            @newObject="newObject" @framesLoaded="framesLoaded"></video-pane>
                <controls-pane v-on:newObject="onNewObject" :framesRange="framesRange"></controls-pane>
            </div>
            <div id="videoObjects">
                <grid-pane :objects="objects"></grid-pane>
            </div>
        </div>
    </Panel>
</script>

