<script>
    Vue.component('visual-pane', {
            template: '#visual-pane',
            props: [],
            data() {
                return {
                    title: 'Visual Annotation',
                    videoTitle: this.$store.state.model.documentMM.videoTitle,
                    segments: this.$store.state.model.segments,
                    currentSegment: 0,
                    currentScale: 50,
                    player: null,
                    playerData: null,
                    ignore_timeupdate: false,
                    reDrawFrame: false,
                    updateGrid: false,
                    options: {},
                    objects: [],
                    object: null,
                    newObject: {
                        index: 0,
                        frame: -1
                    },
                }
            },
            computed: {},
            created() {
            },
            mounted() {
                let that = this;
                $('#segments').combobox({
                    value: this.currentSegment,
                    data: this.segments,
                    onChange: function (value) {
                        that.changeSegment(value);
                    }
                })
            },
            methods: {
                changeSegment(value) {
                    this.currentSegment = value;
                    console.log(this.currentSegment);
                },
                onScaleChanged(value) {
                    console.log('scale changed to ' + value);
                    this.currentScale = value;
                },

                onCreatedNewObject(objectsTracker, newObject) {
                    console.log('new Object');
                    //this.annotatedObjectsSet.add(object)
                    console.log(objectsTracker);
                    this.objects = [];
                    for (object of objectsTracker.annotatedObjects) {
                        this.objects.push(object)
                    }
                    this.object = newObject;
                    this.reDrawFrame = false;
                    this.updateGrid = false;
                },
                onUpdatedObject(objectUpdated) {
                    console.log(object);
                    this.reDrawFrame = true;
                    for (var i = 0; i < this.objects.length; i++) {
                        if (this.objects[i].idObject == objectUpdated.idObject) {
                            this.objects[i] = objectUpdated;
                        }
                    }
                    this.updateGrid = true;
                }
            },
        }
    );
</script>

<script type="text/x-template" id="visual-pane">
    <Panel id="visualAnnotation" :border="false"
           style="width:100%;height:1500px;padding:16px;">
        <div id="videoSegment" style="margin:8px">
            <h3>{{videoTitle}}</h3>
            <input id="segments"></input>
        </div>
        <div style="display:flex; flex-direction: row; height: 100%; width: 100%;align-items: flex-start;">
            <div id="scalePane" style="width:60px">
                <scale-pane @scaleChanged="onScaleChanged"></scale-pane>
            </div>
            <div id="videoPane" style="display:flex; flex-direction: column;padding-left: 16px; width:auto">
                <video-pane :segment="currentSegment"  :reDrawFrame="reDrawFrame"
                            :scale="currentScale" @createdNewObject="onCreatedNewObject"
                ></video-pane>
                <div id="dialogObject" style="display:none">
                    <dialog-pane :object="object" @updatedObject="onUpdatedObject"></dialog-pane>
                </div>
            </div>
            <div id="toolsPane" style="padding:8px">
                <tools-pane :updateGrid="updateGrid"></tools-pane>
            </div>
            <div id="gridPane" style="width:316px;padding:8px">
                <grid-pane :objects="objects" :updateGrid="updateGrid"></grid-pane>
            </div>
        </div>
        </div>
    </Panel>
</script>

