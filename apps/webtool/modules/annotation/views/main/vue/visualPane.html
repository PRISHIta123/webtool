<script>
    Vue.component('visual-pane', {
            template: '#visual-pane',
            props: [],
            data() {
                return {
                    title: 'Visual Annotation',
                    player: null,
                    playerData: null,
                    ignore_timeupdate: false,
                    options: {},
                    objects: [],
                    newBoxFrame: null,
                    annotatedObjectsSet: new AnnotatedObjectsSet(),
                }
            },
            computed: {},
            created() {
            },
            mounted() {
                let that = this;
                this.player = $("#jquery_jplayer_1");
                this.options = {
                    store: that.$store,
                    ready: function (event) {
                        console.log('jsplayer ready');
                        $(this).jPlayer("setMedia", {
                            title: that.$store.state.model.documentMM.videoTitle,
                            m4v: that.$store.state.model.documentMM.videoPath,
                        });
                    },
                    timeupdate: function (event) {
                        if (!that.ignore_timeupdate) {
                            //console.log(event.jPlayer.status.currentTime);
                            that.$store.commit('currentTime', event.jPlayer.status.currentTime);
                            //myControl.progress.slider("setValue", event.jPlayer.status.currentPercentAbsolute);
                        }
                    },
                    play: function (event) {
                        console.log('play');
                        that.$store.commit('currentState', 'playing');
                    },
                    pause: function (event) {
                        console.log('pause');
                        that.$store.commit('currentState', 'paused');
                    },
                    loadeddata: function (event) {
                        console.log('loaded data');
                        console.log('duration = ' + event.jPlayer.status.duration);
                        that.$store.dispatch('setDuration', event.jPlayer.status.duration);
                    },
                    cssSelectorAncestor: "#jp_container_1",
                    swfPath: that.$store.state.model.swfPath,
                    supplied: "m4v",
                    useStateClassSkin: false,
                    autoBlur: false,
                    smoothPlayBar: true,
                    keyEnabled: true,
                    remainingDuration: true,
                    toggleDuration: true,
                    size: {
                        width: "640px",
                        height: "360px",
                        cssClass: "jp-video-360p"
                    }
                }
                this.player.jPlayer(this.options);
                // A pointer to the jPlayer data object
                this.playerData = this.player.data("jPlayer");
            },
            methods: {
                changeValue(value) {
                    let totalFrames = Math.trunc(30 * this.$store.state.duration);
                    this.player.jPlayer("playHead", 100 * value / totalFrames);
                },
                newBox(currentFrame) {
                    console.log('newBox');
                    this.newBoxFrame = currentFrame;
                },
                newObject(objectsTracker) {
                    console.log('new Object');
                    //this.annotatedObjectsSet.add(object)
                    console.log(objectsTracker);

                },
            },
        }
    );
</script>

<script type="text/x-template" id="visual-pane">
    <Panel id="visualAnnotation" style="width:100%; height:55%;" :title="title" :collapsible="false"
           :border="false">
        <div id="visualMarkup"
             style="display:flex; flex-direction: row; height: 100%;padding:10px;background:#fafafa">

            <div id="videoPane" style="width:50%;height:100%;">
                <video-pane style="width:100%; height:100%;" :newBoxFrame="newBoxFrame" @newObject="newObject"></video-pane>
                <controls-pane style="width:100%;" v-on:changeValue="changeValue" v-on:newBox="newBox"></controls-pane>
            </div>
            <div id="videoTable" style="width:50%;height:100%;padding: 10px;">
                <DataGrid id="objectsGrid" ref="objectsGrid" class="f-full"
                          :data="objects"
                          emptyMsg="Nenhum registro"
                          :lazy="true"
                          :virtualScroll="false"
                          loadMsg="Carregando...aguarde."
                          :pagination="false"
                          selectionMode="single"
                          style="width:100%;height:100%;background-color:#CCC"
                >

                    <GridColumn field="idObject" title="ID"></GridColumn>
                    <GridColumn field="visible" title="Visible"></GridColumn>
                    <GridColumn field="hide" title="Hide Others"></GridColumn>
                    <GridColumn field="idFE" title="idFE"></GridColumn>
                    <GridColumn field="fe" title="FE"></GridColumn>
                    <GridColumn field="startTime" title="Start Time"></GridColumn>
                    <GridColumn field="endTime" title="End Time"></GridColumn>
                </DataGrid>
            </div>
        </div>


    </Panel>
</script>

