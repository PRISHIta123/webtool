<script>
    Vue.component('controls-pane', {
            template: '#controls-pane',
            props: ['framesRange'],
            data() {
                return {
                    slider: {
                        min: 0,
                        max: 0,
                        value: 0,
                        //disable: true,
                    },
                    currentTime: 0,
                    currentFrame: 0,
                    currentState: 'paused'
                }
            },
            computed: {},
            created() {
            },
            methods: {
                changeValue(v) {
                    if (this.currentState == 'paused') {
                        this.$store.commit('currentFrame', v);
                    }
                },
                onForwardClick() {
                    if (this.currentState == 'paused') {
                        if (this.slider.value < this.slider.max) {
                            this.slider.value = this.slider.value + 1;
                            this.$store.commit('currentFrame', this.slider.value);
                        }
                    }
                },
                onBackwardClick() {
                    if (this.currentState == 'paused') {
                        if (this.slider.value > this.slider.min) {
                            this.slider.value = this.slider.value - 1;
                            this.$store.commit('currentFrame', this.slider.value);
                        }
                    }
                },
                onPlayClick() {
                    if (this.currentState == 'paused') {
                        this.$store.commit('currentState', 'playing');
                    }
                },
                onPauseClick() {
                    if (this.currentState == 'playing') {
                        this.$store.commit('currentState', 'paused');
                    }
                },
                onNewObject() {
                    if (this.currentState == 'paused') {
                        this.$emit('newObject', this.currentFrame);
                    }
                },
            },
            mounted: function () {
                this.$store.watch(
                    (state, getters) => getters.currentState,
                    (currentState) => {
                        this.currentState = currentState;
                    }
                )
                this.$store.watch(
                    (state, getters) => getters.currentFrame,
                    (currentFrame) => {
                        this.currentFrame = currentFrame;
                        this.slider.value = this.currentFrame;
                        this.$refs.sl.setValue(this.currentFrame);
                        //console.log(this.currentFrame);
                    }
                )
                /*
                this.$store.watch(
                    (state, getters) => getters.duration,
                    (duration) => {
                        console.log('====');
                        this.slider.max = Math.trunc(30 * this.$store.state.duration),
                            this.slider.disable = false;
                        console.log(this.slider);
                    }
                )
                this.$store.watch(
                    (state, getters) => getters.currentTime,
                    (currentTime) => {
                        this.currentTime = currentTime;
                        //console.log(currentTime);
                        //this.sliderValue = Math.trunc(100 * (currentTime / this.$store.state.duration));
                        this.currentFrame = Math.trunc(currentTime * 30);
                        this.slider.value = this.currentFrame;
                        this.$refs.sl.setValue(this.currentFrame);
                        //console.log(this.currentFrame);
                    }
                )

                 */
            },
            watch: {
                framesRange(framesRange) {
                    console.log(framesRange);
                    this.slider.min = framesRange.first;
                    this.slider.max = framesRange.last;
                    let interval = Math.trunc((framesRange.last - framesRange.first + 1) / 5);
                    this.slider.rule = [framesRange.first, '|', framesRange.first + (interval), '|',
                        framesRange.first + (interval * 2), '|', framesRange.first + (interval * 3), '|', framesRange.first + (interval * 4), '|', framesRange.last];
                    this.slider.value = framesRange.first;
                    this.$refs.sl.setValue(framesRange.first);
                }
            }
        }
    );
</script>

<script type="text/x-template" id="controls-pane">
    <div>
        <div id="jp_container_1" role="application" aria-label="media player">
            <div id="controls">
                <LinkButton id="btnBackward" @click="onBackwardClick"><i class="fas fa-step-backward"></i></LinkButton>
                <LinkButton id="btnPlay" @click="onPlayClick"><i class="fas fa-play"></i></LinkButton>
                <LinkButton id="btnPause" @click="onPauseClick"><i class="fas fa-pause"></i></LinkButton>
                <LinkButton id="btnForward" @click="onForwardClick"><i class="fas fa-step-forward"></i></LinkButton>
                <LinkButton id="btnNewObject" iconCls="far fa-square" @click="onNewObject">New Object</LinkButton>
            </div>
            <Slider ref="sl" :showTip="true" :value="slider.value" :min="slider.min" :max="slider.max"
                    :rule="slider.rule" @input="changeValue"></Slider>
            <div id="displayTime">
                <div class="jp-current-time"/>
                <div class="jp-duration"/>
            </div>
        </div>
    </div>
</script>

