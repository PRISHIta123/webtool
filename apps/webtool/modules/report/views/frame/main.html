{{layout '../../../../ui/components/commonLayoutStructure.latte'}}
{{block title}}Frames{{/block}}
{{block north}}
<div>
    <input id="frame" name="frame" type="text" style="width:200px; padding:5px" placeholder="{{_'Search Frame'}}">
</div>
{{/block}}
{{block left}}
<ul id="framesTree"></ul>
{{/block}}

{{block script}}

<script type="text/javascript">
    var idCenterPane = "reportCenterPane";
    var report = {
        isMaster: {{$data->isMaster|noescape}},
        node: null
    };
    $(function () {

        report.reloadFrame = function () {
            $('#commonLayoutCenterPane').html('');
            var node = $('#framesTree').tree('getSelected');
            if (node) {
                $('#framesTree').tree('reload', node.target);
            }
        }

        report.showFrame = function (idFrame) {
            $('#commonLayoutCenterPane').html('');
            manager.doGet({{$manager->getURL('report/frame/showFrame')}} + '/' + idFrame, 'commonLayoutCenterPane');
        }

        report.showLU = function (idLU) {
            $('#commonLayoutCenterPane').html('');
            manager.doGet({{$manager->getURL('report/lu/showLU')}} + '/' + idLU, 'commonLayoutCenterPane');
        }

        $('#frame').textbox({
            buttonIcon: 'icon-search',
            iconAlign:'right',
            prompt: {{_'Search Frame'}},
            onClickButton: function() {
                $('#framesTree').tree({queryParams: {frame: $('#frame').textbox('getValue')}});
            }
        });

        $('#framesTree').tree({
            url: {{$manager->getURL('report/frame/frameTree')}},
            onSelect: function (node) {
                console.log(node);
                if (node.id.charAt(0) == 'f') {
                    report.showFrame(node.id.substr(1));
                }
                if (node.id.charAt(0) == 'l') {
                    report.showLU(node.id.substr(1));
                }
            }
        });
    });
</script>
{{/block}}